<!DOCTYPE html>
<html lang="en">
  <head>
    <title>LiteGraph</title>

    <link
      rel="stylesheet"
      type="text/css"
      href="./litegraph/css/litegraph.css"
    />

    <link rel="stylesheet" type="text/css" href="./json-viewer.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!-- <script src="./iec61131-3.js"></script>
    <script src="./UuidGen.js"></script>
    <script src="./Base64.js"></script>
    <script src="./json-viewer.js"></script> -->

    <!-- <script src="./litegraph/src/litegraph.js"></script> -->
    <!-- <script src="./src/mobjectClientConnection.js"></script>
    <script src="./src/Graph.js"></script>
    <script src="./src/AbilityBase.js"></script>
    <script src="./src/DefaultInputPortFactory.js"></script>
    <script src="./src/DefaultNodeClassFactory.js"></script>
    <script src="./src/GraphCanvas.js"></script>
    <script src="./src/HtmlDialogBase.js"></script>
    <script src="./src/GraphRouterMemoryAbility.js"></script>
    <script src="./src/NodeProtectionAbility.js"></script>
    <script src="./src/NodeTriggerAbility.js"></script>

    <script src="./src/NodeBase.js"></script>
    <script src="./src/PlcApi.js"></script>
    <script src="./src/WidgetBase.js"></script>
    <script src="./src/Widget_Blank.js"></script>
    <script src="./src/Widget_Bool.js"></script>
    <script src="./src/Widget_Combo.js"></script>
    <script src="./src/Widget_Number.js"></script>
    <script src="./src/Widget_Separator.js"></script>
    <script src="./src/Widget_Slider.js"></script>
    <script src="./src/Widget_String.js"></script>
    <script src="./src/Widget_IecAnyFloat.js"></script>
    <script src="./src/Widget_IecAnyInteger.js"></script>
    <script src="./src/Widget_IecEnum.js"></script>
    <script src="./src/WidgetCollection.js"></script>
    <script src="./src/LiteGraphPatch.js"></script>

    <script src="./src/Node_Display_BOOL.js"></script>
    <script src="./src/Node_Literal_BOOL.js"></script>
    <script src="./src/NodePack_PlcBasicDisplay.js"></script>
    <script src="./src/NodePack_PlcBasicLiterals.js"></script>
    <script src="./src/NodePack_PlcBasic.js"></script>

    <script src="./src/LitegraphToMobjectTransformations.js"></script> -->

    <!-- Core -->
    <script src="./litegraph/src/LiteGraph.js"></script>
    <script src="./litegraph/src/LGraph.js"></script>
    <script src="./litegraph/src/LLink.js"></script>
    <script src="./litegraph/src/LGraphNode.js"></script>
    <script src="./litegraph/src/LGraphGroup.js"></script>
    <script src="./litegraph/src/DragAndScale.js"></script>
    <script src="./litegraph/src/LGraphCanvas.js"></script>
    <script src="./litegraph/src/ContextMenu.js"></script>
    <script src="./litegraph/src/CurveEditor.js"></script>
    <script src="./litegraph/src/Editor.js"></script>
    <script src="defaults.js"></script>

    <script src="./src/LitegraphToMobjectTransformations.js"></script>
    <script src="./src/PlcApi.js"></script>
    <script src="./src/EventEmitter.js"></script>
    <script src="./src/NodeBlueprintHandlers.js"></script>
    <script src="./src/Widgets.js"></script>
    <script src="./src/NodeClassFactory.js"></script>
    <script src="./src/WidgetBase.js"></script>
    <script src="./src/widgets/DisplayBooleanWidget.js"></script>
    <script src="./src/Node.js"></script>
    <script src="./src/Graph.js"></script>
    <script src="./src/GraphFramework.js"></script>
    <script src="./src/ServerRpcCall.js"></script>
  </head>
  <body>
    <div id="main"></div>

    <div class="litegraph" style="height: 100%; width: 100%">
      <canvas id="mycanvas" height="600" width="800"></canvas>
    </div>
    <script>
      let apiResponse = {
        blueprints: [
          {
            path: "PlcBasic.Display.Bool",
            node: {
              alarms: ["Deserialization failed"],
              inputPorts: [
                {
                  name: "in",
                  datatype: {
                    type: "BOOL",
                  },
                },
              ],
              contents: [
                {
                  name: "display",
                  datatype: {
                    type: "BOOL",
                  },
                },
              ],
            },
          },
          {
            path: "PlcBasic.Literals.Bool",
            node: {
              alarms: ["Deserialization failed"],
              outputPorts: [
                {
                  name: "out",
                  datatype: {
                    type: "BOOL",
                  },
                },
              ],
              parameters: [
                {
                  name: "value",
                  datatype: {
                    type: "BOOL",
                  },
                  defaultValue: false,
                },
              ],
            },
          },
        ],
      };

      var graphFramework = new GraphFramework(LiteGraph);
      // var factory = new NodeFactoryManager(graphFramework);
      graphFramework.registerWidgetType(DisplayBooleanWidget, "BOOL");
      graphFramework.installNodeBlueprints(apiResponse.blueprints);

      var graph = graphFramework.create();
      var canvas = new LGraphCanvas("#mycanvas", graph);
      var api = new PlcApi(graph, graphFramework);

      graph.on("configurationChanged", () => {
        console.log(graph.serialize());
      });
    </script>
    <button onclick="api.getBlueprints()">Get Blueprints</button>
    <button onclick="api.getStatus()">Get PLC Status</button>
  </body>
</html>
